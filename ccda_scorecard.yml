- include: tasks/node_mongo_tasks.yml

- name: CCDA-Scorecard | git clone
  tags: ccda-scorecard
  action: git repo=https://github.com/chb/ccdaScorecard
              dest=/opt/ccda-scorecard
              version=HEAD

- name: CCDA-Scorecard | npm install dependencies
  tags: ccda-scorecard
  action: command npm install
          chdir=/opt/ccda-scorecard

- name: CCDA-Scorecard | copy umls concepts
  tags: ccda-scorecard-mongo
  action: copy 
          src=files/umls-concepts-mongo.tgz
          dest=/tmp/install/umls-concepts-mongo.tgz
          owner=root group=root mode=0644

- name: CCDA-Scorecard | extract umls concepts
  tags: ccda-scorecard-mongo
  action: command tar -xzvf umls-concepts-mongo.tgz
          chdir=/tmp/install

- name: CCDA-Scorecard | restore umls concepts
  tags: ccda-scorecard-mongo
  action: command mongorestore /tmp/install/dump/vocab --drop

- name: CCDA-Scorecard | startup scripts
  tags: ccda-scorecard
  action: template 
          src=templates/ccda_scorecard/upstart/${item}.j2
          dest=/etc/init/$item
          owner=root group=root mode=0644
  with_items:
    - ccda-scorecard.conf

- name: CCDA-Scorecard | run servers
  tags: ccda-scorecard
  action: service name=$item state=restarted
  with_items: 
    - ccda-scorecard
